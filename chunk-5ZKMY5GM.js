import{A as p,B as y,C as f,a as v,e as O,f as P,h as U,j as b,k as q,l as j,m as F,n as R,o as C,s as l,u as d,x as h,z as m}from"./chunk-MU56VQVL.js";import{E,Ma as D,b as S,p as I,s as c}from"./chunk-IK3SDQQI.js";import{g as n}from"./chunk-OLRFWS6T.js";var k=(()=>{let u=class u{constructor(){this.auth=c(P),this.router=c(D),this.ngZone=c(E),this.firestore=c(C),this.currentUser=new S(null)}signInWithGoogle(){return n(this,null,function*(){try{let t=new O,e=(yield j(this.auth,t)).user,o=m(l(this.firestore,"users"),f("userid","==",e.uid));if((yield h(o)).empty){let a=new Date,i={name:e.displayName||"",email:e.email||"",userid:e.uid,numero:0,membre_date:a.toISOString(),last_conn:a.toISOString()};yield p(d(this.firestore,"users",e.uid),i)}else yield this.setDate(e.email);return localStorage.setItem("userid",e.uid),e}catch(t){return console.error("Erreur Google login:",t),null}})}registerService(t,r,e,o){return n(this,null,function*(){try{let s=new Date,i=(yield U(this.auth,t,r)).user;if(i){yield R(i,{displayName:e});let g={name:e,email:t,userid:i.uid,numero:o,membre_date:s.toISOString(),last_conn:s.toISOString()};return yield p(d(this.firestore,"users",i.uid),g),localStorage.setItem("userid",i.uid),i}return null}catch(s){throw s instanceof v&&s.code==="auth/email-already-in-use"?new Error("Email d\xE9j\xE0 utilis\xE9."):(console.error("Erreur inscription:",s),new Error("Erreur inconnue."))}})}loginService(t,r){return n(this,null,function*(){try{let e=yield q(this.auth,t,r);if(e)return yield this.setDate(e.user.email),localStorage.setItem("userid",e.user.uid),e.user}catch(e){return console.error("Erreur de connexion:",e),null}})}getUserFromFirestore(){return n(this,null,function*(){let t=this.auth.currentUser;if(!t)return null;let r=l(this.firestore,"users"),e=m(r,f("userid","==",t.uid)),o=yield h(e);if(o.empty)return null;{let s=o.docs[0].data();return localStorage.setItem("userid",t.uid),this.router.navigate(["/home"]).then(()=>{setTimeout(()=>window.location.reload(),100)}),s}})}setDate(t){return n(this,null,function*(){if(!t)return;let r=l(this.firestore,"users"),e=m(r,f("email","==",t)),o=yield h(e);if(!o.empty){let s=o.docs[0].id,a=d(this.firestore,"users",s);yield y(a,{last_conn:new Date().toISOString()})}})}updateUserService(t,r,e,o){return n(this,null,function*(){let s=m(l(this.firestore,"users"),f("userid","==",o)),a=yield h(s);if(!a.empty){let i=a.docs[0].id,g=d(this.firestore,"users",i);yield y(g,{name:t,p_email:r,numero:e,last_edit:new Date().toISOString()})}})}resetPassword(t){return n(this,null,function*(){try{yield b(this.auth,t),console.log("Email de r\xE9initialisation envoy\xE9")}catch(r){console.error("Erreur r\xE9initialisation:",r)}})}getUser(){return this.auth.currentUser}signoutService(){return n(this,null,function*(){try{yield F(this.auth),localStorage.removeItem("userid"),this.router.navigate(["/home"]).then(()=>{setTimeout(()=>window.location.reload(),100)})}catch(t){console.error("Erreur d\xE9connexion:",t)}})}};u.\u0275fac=function(r){return new(r||u)},u.\u0275prov=I({token:u,factory:u.\u0275fac,providedIn:"root"});let w=u;return w})();export{k as a};
